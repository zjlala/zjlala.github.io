{"version":3,"file":"index.js","sources":["../../src/node/getTitleFromFilename.ts","../../src/node/logger.ts","../../src/node/generateCatalogPage.ts","../../src/node/locales.ts","../../src/node/catalogPlugin.ts"],"sourcesContent":["const EN_PREPOSITION = [\n  'and',\n  'or',\n  'in',\n  'on',\n  'with',\n  'by',\n  'for',\n  'at',\n  'about',\n  'under',\n  'of',\n  'to',\n  'the',\n  'into',\n]\n\nexport const getTitleFromFilename = (filename: string): string => {\n  const words = filename\n    .replace(/[-_]/gu, ' ')\n    .replace(\n      /(^|[^A-Z])([A-Z])/gu,\n      (_all, match1: string, match2: string) =>\n        `${match1} ${match2.toLowerCase()}`,\n    )\n    .replace(/ +/gu, ' ')\n    .trim()\n    .split(' ')\n\n  return words\n    .map((word, index) =>\n      EN_PREPOSITION.includes(word) && index !== 0\n        ? word\n        : word.charAt(0).toUpperCase() + word.slice(1),\n    )\n    .join(' ')\n}\n","import { Logger } from '@vuepress/helper'\n\nexport const PLUGIN_NAME = '@vuepress/plugin-catalog'\n\nexport const logger = new Logger(PLUGIN_NAME)\n","import type { App } from 'vuepress/core'\nimport { createPage } from 'vuepress/core'\nimport type { PageFrontmatter } from 'vuepress/shared'\nimport { getTitleFromFilename } from './getTitleFromFilename.js'\nimport { logger } from './logger.js'\nimport type { CatalogPluginOptions } from './options.js'\n\nexport const generateCatalogPage = async (\n  app: App,\n  {\n    component = 'Catalog',\n    exclude = [],\n    frontmatter = (): PageFrontmatter => ({}),\n    level = 3,\n    index = false,\n  }: CatalogPluginOptions,\n): Promise<void> => {\n  const {\n    env: { isDebug },\n    pages,\n  } = app\n\n  const pathToBeGenerated = new Set<string>()\n  const content = `\\\n<${component}${[1, 2].includes(level) ? ` :level=\"${level}\"` : ''}${\n    index ? ' index' : ''\n  }/>\n`\n\n  pages.forEach(({ path: pagePath, pathLocale }) => {\n    let catalogPath = pagePath\n\n    // not 404 page\n    if (pagePath !== '/404.html')\n      while (catalogPath !== pathLocale) {\n        catalogPath = catalogPath.replace(/\\/(?:[^/]+\\/?)$/, '/')\n\n        if (\n          // not discovered yet\n          !pathToBeGenerated.has(catalogPath) &&\n          // not being excluded\n          // eslint-disable-next-line @typescript-eslint/no-loop-func\n          exclude.every((pattern) => !catalogPath.match(pattern)) &&\n          // path not found\n          // eslint-disable-next-line @typescript-eslint/no-loop-func\n          pages.every(({ path }) => path !== catalogPath)\n        ) {\n          if (isDebug) logger.info(`Generating catalog ${catalogPath}`)\n\n          pathToBeGenerated.add(catalogPath)\n        }\n      }\n  })\n\n  await Promise.all(\n    Array.from(pathToBeGenerated)\n      .map((path) => decodeURI(path))\n      .map(async (path) => {\n        const [, basename = ''] = /\\/([^/]+)\\/?$/.exec(path) ?? []\n        const title = getTitleFromFilename(basename)\n\n        return createPage(app, {\n          frontmatter: {\n            title,\n            ...frontmatter(path),\n          },\n          content,\n          path,\n        })\n      }),\n  ).then((catalogPages) => {\n    app.pages.push(...catalogPages)\n  })\n}\n","import type { DefaultLocaleInfo } from '@vuepress/helper'\nimport type { CatalogPluginLocaleData } from '../shared/index.js'\n\n/**\n * Default locale info for `@vuepress/plugin-catalog`\n */\nexport const catalogLocaleInfo: DefaultLocaleInfo<CatalogPluginLocaleData> = [\n  [['en', 'en-US'], { title: 'Catalog', empty: 'No catalog' }],\n  [['zh', 'zh-CN', 'zh-Hans'], { title: '目录', empty: '暂无目录' }],\n  [['zh-TW', 'zh-Hant'], { title: '目錄', empty: '暫無目錄' }],\n  [['de', 'de-DE'], { title: 'Katalog', empty: 'Kein Katalog' }],\n  [['vi', 'vi-VN'], { title: 'Danh mục', empty: 'Không có danh mục' }],\n  [['uk'], { title: 'Каталог', empty: 'Немає каталогу' }],\n  [['ru', 'ru-RU'], { title: 'Каталог', empty: 'Нет каталога' }],\n  [['br'], { title: 'Catálogo', empty: 'Sem catálogo' }],\n  [['pl', 'pl-PL'], { title: 'Katalog', empty: 'Brak katalogu' }],\n  [['sk', 'sk-SK'], { title: 'Katalóg', empty: 'Žiadny katalóg' }],\n  [['fr', 'fr-FR'], { title: 'Catalogue', empty: 'Pas de catalogue' }],\n  [['es', 'es-ES'], { title: 'Catálogo', empty: 'Sin catálogo' }],\n  [['ja', 'ja-JP'], { title: 'カタログ', empty: 'カタログなし' }],\n  [['tr', 'tr-TR'], { title: 'Katalog', empty: 'Katalog yok' }],\n  [['ko', 'ko-KO'], { title: '목차', empty: '목차 없음' }],\n  [['fi', 'fi-FI'], { title: 'Luettelo', empty: 'Ei luetteloa' }],\n  [['hu', 'hu-HU'], { title: 'Katalógus', empty: 'Nincs katalógus' }],\n  [['id', 'id-ID'], { title: 'Katalog', empty: 'Tidak ada katalog' }],\n  [['nl', 'nl-NL'], { title: 'Catalogus', empty: 'Geen catalogus' }],\n]\n","import { addViteSsrNoExternal, getFullLocaleConfig } from '@vuepress/helper'\nimport type { PluginFunction } from 'vuepress/core'\nimport { getDirname, path } from 'vuepress/utils'\nimport { generateCatalogPage } from './generateCatalogPage.js'\nimport { catalogLocaleInfo } from './locales.js'\nimport { PLUGIN_NAME, logger } from './logger.js'\nimport type { CatalogPluginOptions } from './options.js'\n\nconst __dirname = import.meta.dirname || getDirname(import.meta.url)\n\n/**\n * Catalog plugin\n *\n * 目录插件\n *\n * @param options plugin options\n *\n * @example\n * ```ts\n * import { catalogPlugin } from '@vuepress/plugin-catalog'\n *\n * export default {\n *   plugins: [\n *     catalogPlugin({\n *       level: 2,\n *       index: true,\n *       exclude: ['/private/']\n *     })\n *   ]\n * }\n * ```\n */\nexport const catalogPlugin =\n  (options: CatalogPluginOptions = {}): PluginFunction =>\n  (app) => {\n    if (app.env.isDebug) logger.info('Options:', options)\n\n    const { component, locales } = options\n\n    return {\n      name: PLUGIN_NAME,\n\n      define: (): Record<string, unknown> => ({\n        __CATALOG_LOCALES__: getFullLocaleConfig({\n          app,\n          name: PLUGIN_NAME,\n          default: catalogLocaleInfo,\n          config: locales,\n        }),\n      }),\n\n      onInitialized: (): Promise<void> => generateCatalogPage(app, options),\n\n      extendsBundlerOptions: (bundlerOptions: unknown): void => {\n        addViteSsrNoExternal(bundlerOptions, app, '@vuepress/helper')\n      },\n\n      ...(component\n        ? {}\n        : { clientConfigFile: path.join(__dirname, '../client/config.js') }),\n    }\n  }\n"],"names":["EN_PREPOSITION","getTitleFromFilename","filename","_all","match1","match2","word","index","PLUGIN_NAME","logger","Logger","generateCatalogPage","app","component","exclude","frontmatter","level","isDebug","pages","pathToBeGenerated","content","pagePath","pathLocale","catalogPath","pattern","path","basename","title","createPage","catalogPages","catalogLocaleInfo","__dirname","getDirname","catalogPlugin","options","locales","getFullLocaleConfig","bundlerOptions","addViteSsrNoExternal"],"mappings":"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"}