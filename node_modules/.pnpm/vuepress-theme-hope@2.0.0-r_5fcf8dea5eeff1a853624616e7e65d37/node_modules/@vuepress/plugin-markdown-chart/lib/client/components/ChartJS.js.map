{"version":3,"file":"ChartJS.js","sources":["../../../src/client/components/ChartJS.ts"],"sourcesContent":["import { LoadingIcon, decodeData, useDarkMode } from '@vuepress/helper/client'\nimport { watchImmediate } from '@vueuse/core'\nimport type { Chart, ChartConfiguration } from 'chart.js'\nimport type { PropType, VNode } from 'vue'\nimport {\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  useId,\n} from 'vue'\n\nimport '../styles/chartjs.css'\n\nconst parseChartConfig = (\n  config: string,\n  type: 'js' | 'json',\n): ChartConfiguration => {\n  if (type === 'json') return JSON.parse(config) as ChartConfiguration\n\n  // eslint-disable-next-line @typescript-eslint/no-implied-eval\n  const runner = new Function(\n    `\\\nlet config,__chart_js_config__;\n{\n${config}\n__chart_js_config__=config;\n}\nreturn __chart_js_config__;\\\n`,\n  ) as () => ChartConfiguration\n\n  return runner()\n}\n\nexport default defineComponent({\n  name: 'ChartJS',\n\n  props: {\n    /**\n     * Chart config\n     *\n     * 图表配置\n     */\n    config: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Chart title\n     *\n     * 图表标题\n     */\n    title: String,\n\n    /**\n     * Chart config type\n     *\n     * 图表配置类型\n     */\n    type: {\n      type: String as PropType<'js' | 'json'>,\n      default: 'json',\n    },\n  },\n\n  setup(props) {\n    const isDarkMode = useDarkMode()\n    const chartElement = shallowRef<HTMLElement>()\n    const id = useId()\n    const loaded = ref(false)\n\n    let chartjs: Chart | null\n\n    const destroyChart = (): void => {\n      chartjs?.destroy()\n      chartjs = null\n    }\n\n    const renderChart = async (): Promise<void> => {\n      if (__VUEPRESS_SSR__) return\n\n      const { default: ChartJs } = await import(\n        /* webpackChunkName: \"chart\" */ 'chart.js/auto'\n      )\n\n      ChartJs.defaults.borderColor = isDarkMode.value ? '#ccc' : '#36A2EB'\n      ChartJs.defaults.color = isDarkMode.value ? '#fff' : '#000'\n      ChartJs.defaults.maintainAspectRatio = false\n\n      const chartConfig = decodeData(props.config)\n      const data = parseChartConfig(chartConfig, props.type)\n\n      chartjs = new ChartJs(id, data)\n    }\n\n    onMounted(() => {\n      watchImmediate(\n        __VUEPRESS_DEV__\n          ? // config must be changed if type is changed, so no need to watch type\n            [() => props.config, isDarkMode]\n          : isDarkMode,\n        async () => {\n          destroyChart()\n          await nextTick()\n          await renderChart()\n          loaded.value = true\n        },\n        { flush: 'post' },\n      )\n    })\n\n    onUnmounted(destroyChart)\n\n    return (): (VNode | null)[] => [\n      props.title\n        ? h('div', { class: 'chartjs-title' }, decodeURIComponent(props.title))\n        : null,\n      loaded.value\n        ? null\n        : h(LoadingIcon, { class: 'chartjs-loading', height: 192 }),\n      h(\n        'div',\n        {\n          ref: chartElement,\n          class: 'chartjs-wrapper',\n          style: {\n            display: loaded.value ? 'block' : 'none',\n          },\n        },\n        h('canvas', {\n          id,\n          height: 400,\n        }),\n      ),\n    ]\n  },\n})\n"],"names":["parseChartConfig","config","type","ChartJS","defineComponent","props","isDarkMode","useDarkMode","chartElement","shallowRef","id","useId","loaded","ref","chartjs","destroyChart","renderChart","ChartJs","chartConfig","decodeData","data","onMounted","watchImmediate","nextTick","onUnmounted","h","LoadingIcon"],"mappings":"kSAiBA,MAAMA,EAAmB,CACvBC,EACAC,IAEIA,IAAS,OAAe,KAAK,MAAMD,CAAM,EAG9B,IAAI,SACjB;AAAA;AAAA,EAGFA,CAAM;AAAA;AAAA;AAAA,4BAKN,EAAA,EAKF,IAAAE,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,OAAQ,CACN,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,OAOP,KAAM,CACJ,KAAM,OACN,QAAS,MACX,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAaC,EAAAA,EACbC,EAAeC,EAAAA,EACfC,EAAKC,EAAAA,EACLC,EAASC,EAAI,EAAK,EAExB,IAAIC,EAEJ,MAAMC,EAAe,IAAY,CAC/BD,GAAS,QAAA,EACTA,EAAU,IACZ,EAEME,EAAc,SAA2B,CAC7C,GAAI,iBAAkB,OAEtB,KAAM,CAAE,QAASC,CAAQ,EAAI,aACK,eAClC,EAEAA,EAAQ,SAAS,YAAcX,EAAW,MAAQ,OAAS,UAC3DW,EAAQ,SAAS,MAAQX,EAAW,MAAQ,OAAS,OACrDW,EAAQ,SAAS,oBAAsB,GAEvC,MAAMC,EAAcC,EAAWd,EAAM,MAAM,EACrCe,EAAOpB,EAAiBkB,EAAab,EAAM,IAAI,EAErDS,EAAU,IAAIG,EAAQP,EAAIU,CAAI,CAChC,EAEA,OAAAC,EAAU,IAAM,CACdC,EACE,iBAEI,CAAC,IAAMjB,EAAM,OAAQC,CAAU,EAC/BA,EACJ,SAAY,CACVS,EAAAA,EACA,MAAMQ,IACN,MAAMP,IACNJ,EAAO,MAAQ,EACjB,EACA,CAAE,MAAO,MAAO,CAClB,CACF,CAAC,EAEDY,EAAYT,CAAY,EAEjB,IAAwB,CAC7BV,EAAM,MACFoB,EAAE,MAAO,CAAE,MAAO,eAAgB,EAAG,mBAAmBpB,EAAM,KAAK,CAAC,EACpE,KACJO,EAAO,MACH,KACAa,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,GAAI,CAAC,EAC5DD,EACE,MACA,CACE,IAAKjB,EACL,MAAO,kBACP,MAAO,CACL,QAASI,EAAO,MAAQ,QAAU,MACpC,CACF,EACAa,EAAE,SAAU,CACV,GAAAf,EACA,OAAQ,GACV,CAAC,CACH,CACF,CACF,CACF,CAAC"}