{"version":3,"file":"VideoPlayer.js","sources":["../../../src/client/components/VideoPlayer.ts"],"sourcesContent":["import { isArray, isString } from \"@vuepress/helper/client\";\nimport type {\n  DASHNamespaceLoader,\n  HLSConstructorLoader,\n  PlayerSrc,\n  PlyrLayoutProps,\n  TextTrackInit,\n} from \"vidstack\";\nimport type { MediaPlayerElement } from \"vidstack/elements\";\nimport type { VidstackPlayerConfig } from \"vidstack/global/player\";\nimport { PlyrLayout, VidstackPlayer } from \"vidstack/global/player\";\nimport type { PropType, VNode } from \"vue\";\nimport {\n  defineComponent,\n  h,\n  onBeforeUnmount,\n  onMounted,\n  shallowRef,\n} from \"vue\";\n\nimport { getLink } from \"../utils/index.js\";\n\nimport \"vidstack/player/styles/base.css\";\nimport \"vidstack/player/styles/plyr/theme.css\";\nimport \"../styles/video-player.scss\";\n\ndeclare const DASHJS_INSTALLED: boolean;\ndeclare const HLS_JS_INSTALLED: boolean;\n\nexport default defineComponent({\n  name: \"VideoPlayer\",\n\n  props: {\n    /**\n     * sources\n     */\n    src: {\n      type: [String, Array, Object] as PropType<PlayerSrc>,\n      required: true,\n    },\n\n    /**\n     * tracks\n     */\n    tracks: { type: Array as PropType<TextTrackInit[]>, default: () => [] },\n\n    /**\n     * poster\n     */\n    poster: String,\n\n    /**\n     * thumbnails\n     */\n    thumbnails: String,\n\n    /**\n     * title\n     */\n    title: String,\n\n    /**\n     * VidStack player options\n     */\n    player: {\n      type: Object as PropType<\n        Omit<\n          VidstackPlayerConfig,\n          \"target\" | \"src\" | \"sources\" | \"tracks\" | \"title\" | \"poster\"\n        >\n      >,\n    },\n\n    /**\n     * VidStack layout options\n     */\n    layout: {\n      type: Object as PropType<Partial<PlyrLayoutProps>>,\n    },\n  },\n\n  setup(props) {\n    const video = shallowRef<HTMLVideoElement>();\n\n    let player: MediaPlayerElement | null = null;\n\n    onMounted(async () => {\n      if (__VUEPRESS_SSR__) return;\n\n      const options: VidstackPlayerConfig = {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        target: video.value!,\n        crossOrigin: true,\n        poster: props.poster,\n        title: props.title,\n        ...props.player,\n        layout: new PlyrLayout({\n          thumbnails: props.thumbnails,\n          ...props.layout,\n        }),\n      };\n\n      options.src = isString(props.src)\n        ? getLink(props.src)\n        : isArray(props.src)\n          ? props.src.map((src) => (isString(src) ? getLink(src) : src))\n          : props.src;\n\n      if (props.tracks.length) options.tracks = props.tracks;\n\n      player = await VidstackPlayer.create(options);\n\n      player.addEventListener(\"provider-change\", () => {\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        if (player!.provider?.type === \"hls\" && HLS_JS_INSTALLED)\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          player!.provider.library = (() =>\n            import(\n              /* webpackChunkName: \"hls\" */ \"hls.js/dist/hls.min.js\"\n            )) as HLSConstructorLoader;\n        // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n        else if (player!.provider?.type === \"dash\" && DASHJS_INSTALLED)\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          player!.provider.library = (() =>\n            import(\n              /* webpackChunkName: \"dashjs\" */ \"dashjs\"\n            )) as DASHNamespaceLoader;\n      });\n    });\n\n    onBeforeUnmount(() => {\n      player?.destroy();\n    });\n\n    return (): VNode => h(\"div\", { ref: video });\n  },\n});\n"],"names":["VideoPlayer","defineComponent","props","video","shallowRef","player","onMounted","options","PlyrLayout","isString","getLink","isArray","src","VidstackPlayer","onBeforeUnmount","h"],"mappings":"saA6BA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,cAEN,MAAO,CAIL,IAAK,CACH,KAAM,CAAC,OAAQ,MAAO,MAAM,EAC5B,SAAU,EACZ,EAKA,OAAQ,CAAE,KAAM,MAAoC,QAAS,IAAM,CAAA,CAAG,EAKtE,OAAQ,OAKR,WAAY,OAKZ,MAAO,OAKP,OAAQ,CACN,KAAM,MAMR,EAKA,OAAQ,CACN,KAAM,MACR,CACF,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAQC,EAAAA,EAEd,IAAIC,EAAoC,KAExC,OAAAC,EAAU,SAAY,CACpB,GAAI,iBAAkB,OAEtB,MAAMC,EAAgC,CAEpC,OAAQJ,EAAM,MACd,YAAa,GACb,OAAQD,EAAM,OACd,MAAOA,EAAM,MACb,GAAGA,EAAM,OACT,OAAQ,IAAIM,EAAW,CACrB,WAAYN,EAAM,WAClB,GAAGA,EAAM,MACX,CAAC,CACH,EAEAK,EAAQ,IAAME,EAASP,EAAM,GAAG,EAC5BQ,EAAQR,EAAM,GAAG,EACjBS,EAAQT,EAAM,GAAG,EACfA,EAAM,IAAI,IAAKU,GAASH,EAASG,CAAG,EAAIF,EAAQE,CAAG,EAAIA,CAAI,EAC3DV,EAAM,IAERA,EAAM,OAAO,SAAQK,EAAQ,OAASL,EAAM,QAEhDG,EAAS,MAAMQ,EAAe,OAAON,CAAO,EAE5CF,EAAO,iBAAiB,kBAAmB,IAAM,CAE3CA,EAAQ,UAAU,OAAS,OAAS,iBAEtCA,EAAQ,SAAS,QAAW,IAC1B,OACgC,wBAChC,EAEKA,EAAQ,UAAU,OAAS,QAAU,mBAE5CA,EAAQ,SAAS,QAAW,IAC1B,OACmC,QACnC,EACN,CAAC,CACH,CAAC,EAEDS,EAAgB,IAAM,CACpBT,GAAQ,QAAA,CACV,CAAC,EAEM,IAAaU,EAAE,MAAO,CAAE,IAAKZ,CAAM,CAAC,CAC7C,CACF,CAAC"}