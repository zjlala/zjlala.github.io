{"version":3,"file":"index.js","sources":["../src/plugin.ts"],"sourcesContent":["/**\n * Forked from https://github.com/markdown-it/markdown-it-footnote/blob/master/index.mjs\n */\n\nimport type { PluginSimple } from \"markdown-it\";\nimport type { RuleBlock } from \"markdown-it/lib/parser_block.mjs\";\nimport type { RuleCore } from \"markdown-it/lib/parser_core.mjs\";\nimport type { RuleInline } from \"markdown-it/lib/parser_inline.mjs\";\nimport type { RenderRule } from \"markdown-it/lib/renderer.mjs\";\nimport type { ParentType } from \"markdown-it/lib/rules_block/state_block.mjs\";\nimport type StateBlock from \"markdown-it/lib/rules_block/state_block.mjs\";\nimport type StateCore from \"markdown-it/lib/rules_core/state_core.mjs\";\nimport type StateInline from \"markdown-it/lib/rules_inline/state_inline.mjs\";\nimport type Token from \"markdown-it/lib/token.mjs\";\n\nimport type { FootNoteEnv, FootNoteToken } from \"./types.js\";\n\ninterface FootNoteStateBlock extends StateBlock {\n  tokens: FootNoteToken[];\n  env: FootNoteEnv;\n}\n\ninterface FootNoteStateInline extends StateInline {\n  tokens: FootNoteToken[];\n  env: FootNoteEnv;\n}\n\ninterface FootNoteStateCore extends StateCore {\n  tokens: FootNoteToken[];\n  env: FootNoteEnv;\n}\n\nconst getIDSuffix = (tokens: FootNoteToken[], index: number): string =>\n  // add suffix when multiple id was found\n  tokens[index].meta.subId > 0 ? `:${tokens[index].meta.subId}` : \"\";\n\nconst renderFootnoteAnchorName: RenderRule = (\n  tokens: FootNoteToken[],\n  index,\n  _options,\n  env: FootNoteEnv,\n): string =>\n  `${\n    // prefix\n    typeof env.docId === \"string\" ? `-${env.docId}-` : \"\"\n  }${\n    // increasing id\n    (tokens[index].meta.id + 1).toString()\n  }`;\n\nconst renderFootnoteCaption: RenderRule = (\n  tokens: FootNoteToken[],\n  index,\n): string =>\n  `[${\n    // number\n    (tokens[index].meta.id + 1).toString()\n  }${getIDSuffix(tokens, index)}]`;\n\nconst renderFootnoteRef: RenderRule = (\n  tokens: FootNoteToken[],\n  index,\n  options,\n  env: FootNoteEnv,\n  self,\n): string => {\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const id = self.rules.footnote_anchorName!(tokens, index, options, env, self);\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  const caption = self.rules.footnote_caption!(\n    tokens,\n    index,\n    options,\n    env,\n    self,\n  );\n\n  return `<sup class=\"footnote-ref\"><a href=\"#footnote${id}\">${caption}</a><a class=\"footnote-anchor\" id=\"footnote-ref${id}${getIDSuffix(\n    tokens,\n    index,\n  )}\"></a></sup>`;\n};\n\nconst renderFootnoteBlockOpen: RenderRule = (\n  _tokens: FootNoteToken[],\n  _index,\n  options,\n): string =>\n  `\\\n<hr class=\"footnotes-sep\"${options.xhtmlOut ? \" /\" : \"\"}>\n<section class=\"footnotes\">\n<ol class=\"footnotes-list\">\n`;\n\nconst renderFootnoteBlockClose = (): string => `\\\n</ol>\n</section>\n`;\n\nconst renderFootnoteOpen: RenderRule = (\n  tokens: FootNoteToken[],\n  index,\n  options,\n  env: FootNoteEnv,\n  self,\n): string =>\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  `<li id=\"footnote${self.rules.footnote_anchorName!(\n    tokens,\n    index,\n    options,\n    env,\n    self,\n  )}${getIDSuffix(tokens, index)}\" class=\"footnote-item\">`;\n\nconst renderFootnoteClose = (): string => \"</li>\\n\";\n\nconst renderFootnoteAnchor: RenderRule = (\n  tokens: FootNoteToken[],\n  index,\n  options,\n  env: FootNoteEnv,\n  self,\n): string =>\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  ` <a href=\"#footnote-ref${self.rules.footnote_anchorName!(\n    tokens,\n    index,\n    options,\n    env,\n    self,\n  )}${\n    getIDSuffix(tokens, index)\n    /* ↩ with escape code to prevent display as Apple Emoji on iOS */\n  }\" class=\"footnote-backref\">\\u21a9\\uFE0E</a>`;\n\n// Process footnote block definition\nconst footnoteDef: RuleBlock = (\n  state: FootNoteStateBlock,\n  startLine,\n  endLine,\n  silent,\n) => {\n  const start = state.bMarks[startLine] + state.tShift[startLine];\n  const max = state.eMarks[startLine];\n  let char: number;\n\n  if (\n    // line should be at least 5 chars - \"[^x]:\"\n    start + 4 > max ||\n    state.src.charCodeAt(start) !== 91 /* [ */ ||\n    state.src.charCodeAt(start + 1) !== 94 /* ^ */\n  )\n    return false;\n\n  let pos = start + 2;\n\n  while (pos < max) {\n    char = state.src.charCodeAt(pos);\n    if (char === 32 /* space */) return false;\n    if (char === 93 /* ] */) break;\n    pos++;\n  }\n\n  if (\n    // empty footnote label\n    pos === start + 2 ||\n    pos + 1 >= max ||\n    state.src.charCodeAt(++pos) !== 58 /* : */\n  )\n    return false;\n\n  if (silent) return true;\n  pos++;\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  (state.env.footnotes ??= {}).refs ??= {};\n\n  const label = state.src.slice(start + 2, pos - 2);\n\n  state.env.footnotes.refs[`:${label}`] = -1;\n\n  const referenceOpenToken = state.push(\"footnote_reference_open\", \"\", 1);\n\n  referenceOpenToken.meta = { label };\n  referenceOpenToken.level = state.level++;\n\n  const oldBMark = state.bMarks[startLine];\n  const oldTShift = state.tShift[startLine];\n  const oldSCount = state.sCount[startLine];\n  const oldParentType = state.parentType;\n  const posAfterColon = pos;\n  const initial =\n    state.sCount[startLine] +\n    pos -\n    (state.bMarks[startLine] + state.tShift[startLine]);\n\n  let offset = initial;\n\n  while (pos < max) {\n    const char = state.src.charCodeAt(pos);\n\n    if (char === 9 /* \\t */) offset += 4 - (offset % 4);\n    else if (char === 32 /* space */) offset++;\n    else break;\n\n    pos++;\n  }\n\n  state.tShift[startLine] = pos - posAfterColon;\n  state.sCount[startLine] = offset - initial;\n  state.bMarks[startLine] = posAfterColon;\n  state.blkIndent += 4;\n  state.parentType = \"footnote\" as unknown as ParentType;\n\n  if (state.sCount[startLine] < state.blkIndent)\n    state.sCount[startLine] += state.blkIndent;\n\n  state.md.block.tokenize(state, startLine, endLine);\n\n  state.parentType = oldParentType;\n  state.blkIndent -= 4;\n  state.tShift[startLine] = oldTShift;\n  state.sCount[startLine] = oldSCount;\n  state.bMarks[startLine] = oldBMark;\n\n  const referenceCloseToken = state.push(\"footnote_reference_close\", \"\", -1);\n\n  referenceCloseToken.level = --state.level;\n\n  return true;\n};\n\n// Process inline footnotes (^[...])\nconst footnoteInline: RuleInline = (state: FootNoteStateInline, silent) => {\n  const max = state.posMax;\n  const start = state.pos;\n\n  if (\n    start + 2 >= max ||\n    state.src.charCodeAt(start) !== 94 /* ^ */ ||\n    state.src.charCodeAt(start + 1) !== 91 /* [ */\n  )\n    return false;\n\n  const labelEnd = state.md.helpers.parseLinkLabel(state, start + 1);\n\n  // parser failed to find ']', so it’s not a valid note\n  if (labelEnd < 0) return false;\n\n  const labelStart = start + 2;\n\n  /*\n   * We found the end of the link, and know for a fact it’s a valid link;\n   * so all that’s left to do is to call tokenizer.\n   *\n   */\n  if (!silent) {\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    const list = ((state.env.footnotes ??= {}).list ??= []);\n    const footnoteId = list.length;\n    const tokens: Token[] = [];\n\n    state.md.inline.parse(\n      state.src.slice(labelStart, labelEnd),\n      state.md,\n      state.env,\n      tokens,\n    );\n\n    const refToken = state.push(\"footnote_ref\", \"\", 0);\n\n    refToken.meta = { id: footnoteId };\n\n    state.env.footnotes.list[footnoteId] = {\n      content: state.src.slice(labelStart, labelEnd),\n      tokens,\n    };\n  }\n\n  state.pos = labelEnd + 1;\n  state.posMax = max;\n\n  return true;\n};\n\n// Process footnote references ([^...])\nconst footnoteRef: RuleInline = (state: FootNoteStateInline, silent) => {\n  const start = state.pos;\n  const max = state.posMax;\n  let char: number;\n\n  if (\n    // should be at least 4 chars - \"[^x]\"\n    start + 3 > max ||\n    // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n    !state.env.footnotes?.refs ||\n    state.src.charCodeAt(start) !== 91 /* [ */ ||\n    state.src.charCodeAt(start + 1) !== 94 /* ^ */\n  )\n    return false;\n\n  let pos = start + 2;\n\n  while (pos < max) {\n    char = state.src.charCodeAt(pos);\n    if (char === 32 /* space */ || char === 10 /* \\n */) return false;\n    if (char === 93 /* ] */) break;\n    pos++;\n  }\n\n  // empty footnote labels\n  if (pos === start + 2 || pos >= max) return false;\n\n  pos++;\n\n  const label = state.src.slice(start + 2, pos - 1);\n\n  if (typeof state.env.footnotes.refs[`:${label}`] === \"undefined\")\n    return false;\n\n  if (!silent) {\n    const list = (state.env.footnotes.list ??= []);\n    const { refs } = state.env.footnotes;\n    let footnoteId: number;\n\n    if (refs[`:${label}`] < 0) {\n      footnoteId = list.length;\n      list[footnoteId] = { label, count: 0 };\n      refs[`:${label}`] = footnoteId;\n    } else {\n      footnoteId = refs[`:${label}`];\n    }\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    const subId = list[footnoteId].count!;\n\n    // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    list[footnoteId].count = list[footnoteId].count! + 1;\n\n    const refToken = state.push(\"footnote_ref\", \"\", 0);\n\n    refToken.meta = { id: footnoteId, subId, label };\n  }\n\n  state.pos = pos;\n  state.posMax = max;\n\n  return true;\n};\n\n// Glue footnote tokens to end of token stream\nconst footnoteTail: RuleCore = (state: FootNoteStateCore): boolean => {\n  const refTokens: Record<string, Token[]> = {};\n\n  let current: Token[];\n  let currentLabel: string;\n  let isInsideRef = false;\n\n  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n  if (!state.env.footnotes?.list) {\n    // If no footnotes list, remove all footnote reference tokens\n    state.tokens = state.tokens.filter((stateToken) => {\n      if (stateToken.type === \"footnote_reference_open\") {\n        isInsideRef = true;\n\n        return false;\n      }\n\n      if (stateToken.type === \"footnote_reference_close\") {\n        isInsideRef = false;\n\n        return false;\n      }\n\n      return !isInsideRef;\n    });\n\n    return false;\n  }\n\n  const { list } = state.env.footnotes;\n\n  state.tokens = state.tokens.filter((stateToken) => {\n    if (stateToken.type === \"footnote_reference_open\") {\n      isInsideRef = true;\n      current = [];\n      currentLabel = stateToken.meta.label;\n\n      return false;\n    }\n\n    if (stateToken.type === \"footnote_reference_close\") {\n      isInsideRef = false;\n      // prepend ':' to avoid conflict with Object.prototype members\n      refTokens[`:${currentLabel}`] = current;\n\n      return false;\n    }\n    if (isInsideRef) current.push(stateToken);\n\n    return !isInsideRef;\n  });\n\n  const footnoteBlockOpenToken = new state.Token(\"footnote_block_open\", \"\", 1);\n\n  state.tokens.push(footnoteBlockOpenToken);\n\n  for (let index = 0, { length } = list; index < length; index++) {\n    const footnoteOpenToken = new state.Token(\"footnote_open\", \"\", 1);\n\n    footnoteOpenToken.meta = { id: index, label: list[index].label };\n    state.tokens.push(footnoteOpenToken);\n\n    let lastParagraph: FootNoteToken | null;\n\n    if (list[index].tokens) {\n      const paragraphOpenToken = new state.Token(\"paragraph_open\", \"p\", 1);\n\n      paragraphOpenToken.block = true;\n\n      const inlineToken = new state.Token(\"inline\", \"\", 0);\n\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      inlineToken.children = list[index].tokens!;\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      inlineToken.content = list[index].content!;\n\n      const paragraphCloseToken = new state.Token(\"paragraph_close\", \"p\", -1);\n\n      paragraphCloseToken.block = true;\n\n      state.tokens.push(paragraphOpenToken, inlineToken, paragraphCloseToken);\n    } else if (list[index].label) {\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      const tokens = refTokens[`:${list[index].label!}`];\n\n      // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition\n      if (tokens) state.tokens.push(...tokens);\n    }\n\n    if (state.tokens[state.tokens.length - 1].type === \"paragraph_close\")\n      lastParagraph = state.tokens.pop() ?? null;\n    else lastParagraph = null;\n\n    for (\n      let j = 0;\n      // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n      j < (Number(list[index].count) > 0 ? list[index].count! : 1);\n      j++\n    ) {\n      const footnoteAnchorToken = new state.Token(\"footnote_anchor\", \"\", 0);\n\n      footnoteAnchorToken.meta = {\n        id: index,\n        subId: j,\n        label: list[index].label,\n      };\n      state.tokens.push(footnoteAnchorToken);\n    }\n\n    if (lastParagraph) state.tokens.push(lastParagraph);\n\n    state.tokens.push(new state.Token(\"footnote_close\", \"\", -1));\n  }\n\n  state.tokens.push(new state.Token(\"footnote_block_close\", \"\", -1));\n\n  return true;\n};\n\nexport const footnote: PluginSimple = (md) => {\n  md.renderer.rules.footnote_ref = renderFootnoteRef;\n  md.renderer.rules.footnote_block_open = renderFootnoteBlockOpen;\n  md.renderer.rules.footnote_block_close = renderFootnoteBlockClose;\n  md.renderer.rules.footnote_open = renderFootnoteOpen;\n  md.renderer.rules.footnote_close = renderFootnoteClose;\n  md.renderer.rules.footnote_anchor = renderFootnoteAnchor;\n\n  // helpers (only used in other rules, no tokens are attached to those)\n  // helpers (only used in other rules, no tokens are attached to those)\n  md.renderer.rules.footnote_caption = renderFootnoteCaption;\n  md.renderer.rules.footnote_anchorName = renderFootnoteAnchorName;\n\n  md.block.ruler.before(\"reference\", \"footnoteDef\", footnoteDef, {\n    alt: [\"paragraph\", \"reference\"],\n  });\n  md.inline.ruler.after(\"image\", \"footnoteInline\", footnoteInline);\n  md.inline.ruler.after(\"footnoteInline\", \"footnote_ref\", footnoteRef);\n  md.core.ruler.after(\"inline\", \"footnoteTail\", footnoteTail);\n};\n"],"names":["getIDSuffix","tokens","index","renderFootnoteAnchorName","_options","env","renderFootnoteCaption","renderFootnoteRef","options","self","id","caption","renderFootnoteBlockOpen","_tokens","_index","renderFootnoteBlockClose","renderFootnoteOpen","renderFootnoteClose","renderFootnoteAnchor","footnoteDef","state","startLine","endLine","silent","start","max","char","pos","label","referenceOpenToken","oldBMark","oldTShift","oldSCount","oldParentType","posAfterColon","initial","offset","referenceCloseToken","footnoteInline","labelEnd","labelStart","footnoteId","refToken","footnoteRef","list","refs","subId","footnoteTail","refTokens","current","currentLabel","isInsideRef","stateToken","footnoteBlockOpenToken","length","footnoteOpenToken","lastParagraph","paragraphOpenToken","inlineToken","paragraphCloseToken","j","footnoteAnchorToken","footnote","md"],"mappings":"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"}