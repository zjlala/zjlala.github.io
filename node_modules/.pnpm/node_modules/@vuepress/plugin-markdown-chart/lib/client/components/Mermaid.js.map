{"version":3,"file":"Mermaid.js","sources":["../../../src/client/utils/encodeSVG.ts","../../../src/client/utils/icons.ts","../../../src/client/components/Mermaid.ts"],"sourcesContent":["export const encodeSVG = (svg: string): string =>\n  `data:image/svg+xml;charset=utf8,${svg\n    .replace(/<br>/g, '<br />')\n    .replace(/%/g, '%25')\n    .replace(/\"/g, '%22')\n    .replace(/'/g, '%27')\n    .replace(/&/g, '%26')\n    .replace(/#/g, '%23')\n    .replace(/{/g, '%7B')\n    .replace(/}/g, '%7D')\n    .replace(/</g, '%3C')\n    .replace(/>/g, '%3E')}`\n","export const PREVIEW_ICON =\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1316 1024\" fill=\"currentColor\"><path d=\"M658.286 0C415.89 0 0 297.106 0 512c0 214.82 415.89 512 658.286 512 242.322 0 658.285-294.839 658.285-512S900.608 0 658.286 0zm0 877.714c-161.573 0-512-221.769-512-365.714 0-144.018 350.427-365.714 512-365.714 161.572 0 512 217.16 512 365.714s-350.428 365.714-512 365.714z\"/><path d=\"M658.286 292.571a219.429 219.429 0 1 0 0 438.858 219.429 219.429 0 0 0 0-438.858zm0 292.572a73.143 73.143 0 1 1 0-146.286 73.143 73.143 0 0 1 0 146.286z\"/></svg>'\n\nexport const DOWNLOAD_ICON =\n  '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1024 1024\" fill=\"currentColor\"><path d=\"M828.976 894.125H190.189c-70.55 0-127.754-57.185-127.754-127.753V606.674c0-17.634 14.31-31.933 31.933-31.933h63.889c17.634 0 31.932 14.299 31.932 31.933v95.822c0 35.282 28.596 63.877 63.877 63.877h511.033c35.281 0 63.877-28.595 63.877-63.877v-95.822c0-17.634 14.298-31.933 31.943-31.933h63.878c17.635 0 31.933 14.299 31.933 31.933v159.7c0 70.566-57.191 127.751-127.754 127.751zM249.939 267.51c12.921-12.92 33.885-12.92 46.807 0l148.97 148.972V94.893c0-17.634 14.302-31.947 31.934-31.947h63.876c17.638 0 31.946 14.313 31.946 31.947v321.589l148.97-148.972c12.922-12.92 33.876-12.92 46.797 0l46.814 46.818c12.922 12.922 12.922 33.874 0 46.807L552.261 624.93c-1.14 1.138-21.664 13.684-42.315 13.693-20.877.01-41.88-12.542-43.021-13.693L203.122 361.135c-12.923-12.934-12.923-33.885 0-46.807l46.817-46.818z\"/></svg>'\n","import {\n  LoadingIcon,\n  decodeData,\n  isFunction,\n  useDarkMode,\n} from '@vuepress/helper/client'\nimport { watchImmediate } from '@vueuse/core'\nimport type { VNode } from 'vue'\nimport {\n  computed,\n  defineComponent,\n  h,\n  onMounted,\n  ref,\n  shallowRef,\n  useId,\n} from 'vue'\n\nimport { useMermaidOptions } from '../helpers/index.js'\nimport { DOWNLOAD_ICON, PREVIEW_ICON, encodeSVG } from '../utils/index.js'\n\nimport '../styles/mermaid.css'\n\nconst DEFAULT_CHART_OPTIONS = { useMaxWidth: false }\n\nexport default defineComponent({\n  name: 'Mermaid',\n\n  props: {\n    /**\n     * Mermaid config\n     *\n     * Mermaid 配置\n     */\n    code: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Mermaid title\n     *\n     * Mermaid 标题\n     */\n    title: String,\n  },\n\n  setup(props) {\n    const id = useId()\n    const isDarkMode = useDarkMode()\n    const { themeVariables, ...mermaidOptions } = useMermaidOptions()\n    const mermaidElement = shallowRef<HTMLElement>()\n\n    const code = computed(() => decodeData(props.code))\n\n    const svgCode = ref('')\n\n    const renderMermaid = async (): Promise<void> => {\n      if (__VUEPRESS_SSR__) return\n\n      const { default: mermaid } = await import(\n        /* webpackChunkName: \"mermaid\" */ 'mermaid/dist/mermaid.esm.min.mjs'\n      )\n\n      mermaid.initialize({\n        theme: isDarkMode.value ? 'dark' : 'default',\n        themeVariables: {\n          dark: isDarkMode.value,\n          ...(isFunction(themeVariables)\n            ? themeVariables(isDarkMode.value)\n            : themeVariables),\n        },\n        flowchart: DEFAULT_CHART_OPTIONS,\n        sequence: DEFAULT_CHART_OPTIONS,\n        journey: DEFAULT_CHART_OPTIONS,\n        gantt: DEFAULT_CHART_OPTIONS,\n        er: DEFAULT_CHART_OPTIONS,\n        pie: DEFAULT_CHART_OPTIONS,\n        ...mermaidOptions,\n        startOnLoad: false,\n      })\n\n      svgCode.value = (await mermaid.render(id, code.value)).svg\n    }\n\n    const preview = (): void => {\n      const { body } = document\n      const div = document.createElement('div')\n\n      div.classList.add('mermaid-preview')\n\n      div.innerHTML = svgCode.value\n      body.appendChild(div)\n\n      div.addEventListener('click', () => {\n        body.removeChild(div)\n      })\n    }\n\n    const download = (): void => {\n      const dataURI = encodeSVG(svgCode.value)\n\n      const a = document.createElement('a')\n\n      a.setAttribute('href', dataURI)\n      a.setAttribute(\n        'download',\n        `${props.title ? decodeData(props.title) : id}.svg`,\n      )\n      a.click()\n    }\n\n    onMounted(() => {\n      watchImmediate(isDarkMode, renderMermaid, {\n        flush: 'post',\n      })\n    })\n\n    return (): VNode[] => [\n      h('div', { class: 'mermaid-actions' }, [\n        h('button', {\n          class: 'preview-button',\n          title: 'preview',\n          innerHTML: PREVIEW_ICON,\n          onClick: preview,\n        }),\n        h('button', {\n          class: 'download-button',\n          title: 'download',\n          innerHTML: DOWNLOAD_ICON,\n          onClick: download,\n        }),\n      ]),\n      h(\n        'div',\n        {\n          ref: mermaidElement,\n          class: 'mermaid-wrapper',\n        },\n        svgCode.value\n          ? // Mermaid\n            h('div', { class: 'mermaid-content', innerHTML: svgCode.value })\n          : // Loading\n            h(LoadingIcon, { class: 'mermaid-loading', height: 96 }),\n      ),\n    ]\n  },\n})\n"],"names":["encodeSVG","svg","PREVIEW_ICON","DOWNLOAD_ICON","DEFAULT_CHART_OPTIONS","Mermaid","defineComponent","props","id","useId","isDarkMode","useDarkMode","themeVariables","mermaidOptions","useMermaidOptions","mermaidElement","shallowRef","code","computed","decodeData","svgCode","ref","renderMermaid","mermaid","isFunction","preview","body","div","download","dataURI","a","onMounted","watchImmediate","h","LoadingIcon"],"mappings":"4UAAO,MAAMA,EAAaC,GACxB,mCAAmCA,EAChC,QAAQ,QAAS,QAAQ,EACzB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,EACnB,QAAQ,KAAM,KAAK,CAAC,GCXZC,EACX,6hBAEWC,EACX,y4BCmBIC,EAAwB,CAAE,YAAa,EAAM,EAEnD,IAAAC,EAAeC,EAAgB,CAC7B,KAAM,UAEN,MAAO,CAML,KAAM,CACJ,KAAM,OACN,SAAU,EACZ,EAOA,MAAO,MACT,EAEA,MAAMC,EAAO,CACX,MAAMC,EAAKC,IACLC,EAAaC,IACb,CAAE,eAAAC,EAAgB,GAAGC,CAAe,EAAIC,IACxCC,EAAiBC,EAAAA,EAEjBC,EAAOC,EAAS,IAAMC,EAAWZ,EAAM,IAAI,CAAC,EAE5Ca,EAAUC,EAAI,EAAE,EAEhBC,EAAgB,SAA2B,CAC/C,GAAI,iBAAkB,OAEtB,KAAM,CAAE,QAASC,CAAQ,EAAI,KAAM,QACC,kCACpC,EAEAA,EAAQ,WAAW,CACjB,MAAOb,EAAW,MAAQ,OAAS,UACnC,eAAgB,CACd,KAAMA,EAAW,MACjB,GAAIc,EAAWZ,CAAc,EACzBA,EAAeF,EAAW,KAAK,EAC/BE,CACN,EACA,UAAWR,EACX,SAAUA,EACV,QAASA,EACT,MAAOA,EACP,GAAIA,EACJ,IAAKA,EACL,GAAGS,EACH,YAAa,EACf,CAAC,EAEDO,EAAQ,OAAS,MAAMG,EAAQ,OAAOf,EAAIS,EAAK,KAAK,GAAG,GACzD,EAEMQ,EAAU,IAAY,CAC1B,KAAM,CAAE,KAAAC,CAAK,EAAI,SACXC,EAAM,SAAS,cAAc,KAAK,EAExCA,EAAI,UAAU,IAAI,iBAAiB,EAEnCA,EAAI,UAAYP,EAAQ,MACxBM,EAAK,YAAYC,CAAG,EAEpBA,EAAI,iBAAiB,QAAS,IAAM,CAClCD,EAAK,YAAYC,CAAG,CACtB,CAAC,CACH,EAEMC,EAAW,IAAY,CAC3B,MAAMC,EAAU7B,EAAUoB,EAAQ,KAAK,EAEjCU,EAAI,SAAS,cAAc,GAAG,EAEpCA,EAAE,aAAa,OAAQD,CAAO,EAC9BC,EAAE,aACA,WACA,GAAGvB,EAAM,MAAQY,EAAWZ,EAAM,KAAK,EAAIC,CAAE,MAC/C,EACAsB,EAAE,OACJ,EAEA,OAAAC,EAAU,IAAM,CACdC,EAAetB,EAAYY,EAAe,CACxC,MAAO,MACT,CAAC,CACH,CAAC,EAEM,IAAe,CACpBW,EAAE,MAAO,CAAE,MAAO,iBAAkB,EAAG,CACrCA,EAAE,SAAU,CACV,MAAO,iBACP,MAAO,UACP,UAAW/B,EACX,QAASuB,CACX,CAAC,EACDQ,EAAE,SAAU,CACV,MAAO,kBACP,MAAO,WACP,UAAW9B,EACX,QAASyB,CACX,CAAC,CACH,CAAC,EACDK,EACE,MACA,CACE,IAAKlB,EACL,MAAO,iBACT,EACAK,EAAQ,MAEJa,EAAE,MAAO,CAAE,MAAO,kBAAmB,UAAWb,EAAQ,KAAM,CAAC,EAE/Da,EAAEC,EAAa,CAAE,MAAO,kBAAmB,OAAQ,EAAG,CAAC,CAC7D,CACF,CACF,CACF,CAAC"}