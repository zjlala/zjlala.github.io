{"version":3,"file":"index.js","sources":["../../package.json","../../src/node/generate/getRedirectHTML.ts","../../src/cli/index.ts"],"sourcesContent":["{\n  \"name\": \"@vuepress/plugin-redirect\",\n  \"version\": \"2.0.0-rc.112\",\n  \"description\": \"VuePress plugin - redirect\",\n  \"keywords\": [\n    \"vuepress-plugin\",\n    \"vuepress\",\n    \"plugin\",\n    \"redirect\"\n  ],\n  \"homepage\": \"https://ecosystem.vuejs.press/plugins/tools/redirect.html\",\n  \"bugs\": {\n    \"url\": \"https://github.com/vuepress/ecosystem/issues\"\n  },\n  \"repository\": {\n    \"type\": \"git\",\n    \"url\": \"git+https://github.com/vuepress/ecosystem.git\",\n    \"directory\": \"plugins/tools/plugin-redirect\"\n  },\n  \"license\": \"MIT\",\n  \"author\": {\n    \"name\": \"Mr.Hope\",\n    \"email\": \"mister-hope@outlook.com\",\n    \"url\": \"https://mister-hope.com\"\n  },\n  \"type\": \"module\",\n  \"exports\": {\n    \".\": \"./lib/node/index.js\",\n    \"./client\": \"./lib/client/index.js\",\n    \"./package.json\": \"./package.json\"\n  },\n  \"main\": \"./lib/node/index.js\",\n  \"types\": \"./lib/node/index.d.ts\",\n  \"bin\": {\n    \"vp-redirect\": \"./lib/cli/index.js\"\n  },\n  \"files\": [\n    \"lib\"\n  ],\n  \"scripts\": {\n    \"build\": \"tsc -b tsconfig.build.json\",\n    \"bundle\": \"rollup -c rollup.config.ts --configPlugin esbuild\",\n    \"clean\": \"rimraf --glob ./lib ./*.tsbuildinfo\",\n    \"style\": \"sass src:lib --embed-sources --style=compressed --pkg-importer=node\"\n  },\n  \"dependencies\": {\n    \"@vuepress/helper\": \"workspace:*\",\n    \"@vueuse/core\": \"catalog:\",\n    \"commander\": \"^14.0.0\",\n    \"vue\": \"catalog:\"\n  },\n  \"peerDependencies\": {\n    \"vuepress\": \"catalog:\"\n  },\n  \"publishConfig\": {\n    \"access\": \"public\"\n  }\n}\n","export const getRedirectHTML = (redirectUrl: string): string => `<!doctype html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"robots\" content=\"noindex\">\n  <meta http-equiv=\"refresh\" content=\"0; url=${redirectUrl}\">\n  <link rel=\"canonical\" href=\"${redirectUrl}\">\n  <title>Redirecting...</title>\n  <script>\n    const anchor = window.location.hash.slice(1);\n    window.location.replace(\\`${redirectUrl}\\${anchor? \\`#\\${anchor}\\`: \"\"}\\`);\n  </script>\n</head>\n<body>\n  <p>Redirecting...</p>\n</body>\n</html>\n`\n","#!/usr/bin/env node\nimport { removeEndingSlash, removeLeadingSlash } from '@vuepress/helper'\nimport { createCommand } from 'commander'\nimport {\n  loadUserConfig,\n  resolveAppConfig,\n  resolveCliAppConfig,\n  resolveUserConfigConventionalPath,\n  resolveUserConfigPath,\n  transformUserConfigToPlugin,\n} from 'vuepress/cli'\nimport { createBuildApp } from 'vuepress/core'\nimport { fs, logger, path } from 'vuepress/utils'\nimport pkg from '../../package.json' with { type: 'json' }\nimport { getRedirectHTML } from '../node/generate/getRedirectHTML.js'\n\ninterface RedirectCommandOptions {\n  hostname: string\n  config?: string\n  cache?: string\n  temp?: string\n  cleanCache?: boolean\n  cleanTemp?: boolean\n}\n\nconst program = createCommand('vp-redirect')\n\nprogram\n  .summary('Generate redirect site')\n  .description('Generate redirect site for current VuePress project')\n  .option(\n    '--hostname <hostname>',\n    'Hostname to redirect to (E.g.: https://new.example.com/)',\n    '/',\n  )\n  .option('-c, --config [config]', 'Set path to config file')\n  .option('--cache [cache]', 'Set the directory of the cache files')\n  .option('--temp [temp]', 'Set the directory of the temporary files')\n  .option('--clean-cache', 'Clean the cache files before generation')\n  .option('--clean-temp', 'Clean the temporary files before generation')\n  .argument('<source>', 'Source directory of VuePress project')\n  .argument(\n    '[output]',\n    'Output folder (default: .vuepress/redirect relative to source folder)',\n  )\n  .action(\n    async (\n      sourceDir: string,\n      output: string | undefined,\n      commandOptions: RedirectCommandOptions,\n    ) => {\n      // ensure NODE_ENV is set\n      process.env.NODE_ENV ??= 'production'\n\n      if (!fs.existsSync(sourceDir)) {\n        program.error(`Source directory ${sourceDir} does not exist!`)\n      }\n\n      // resolve app config from cli options\n      const cliAppConfig = resolveCliAppConfig(sourceDir, {})\n\n      // resolve user config file\n      const userConfigPath = commandOptions.config\n        ? resolveUserConfigPath(commandOptions.config)\n        : resolveUserConfigConventionalPath(cliAppConfig.source)\n\n      const { userConfig } = await loadUserConfig(userConfigPath)\n\n      // resolve the final app config to use\n      const appConfig = resolveAppConfig({\n        defaultAppConfig: {\n          cache: commandOptions.cache,\n          temp: commandOptions.temp,\n        },\n        cliAppConfig,\n        userConfig,\n      })\n\n      if (appConfig === null) return\n\n      // create vuepress app\n      const app = createBuildApp(appConfig)\n\n      // use user-config plugin\n      app.use(transformUserConfigToPlugin(userConfig, cliAppConfig.source))\n\n      // clean temp and cache\n      if (commandOptions.cleanTemp === true) {\n        logger.info('Cleaning temp...')\n        await fs.remove(app.dir.temp())\n      }\n      if (commandOptions.cleanCache === true) {\n        logger.info('Cleaning cache...')\n        await fs.remove(app.dir.cache())\n      }\n\n      const outputFolder = output\n        ? path.join(process.cwd(), output)\n        : path.join(app.dir.source(), '.vuepress', 'redirect')\n\n      // empty output directory\n      await fs.emptyDir(outputFolder)\n\n      logger.info('Initializing VuePress and preparing data...')\n\n      // initialize vuepress app to get pages\n      await app.init()\n\n      logger.info('Generating redirect pages...')\n\n      // redirect all pages\n      await Promise.all(\n        app.pages.map((page) => {\n          const redirectUrl = `${removeEndingSlash(commandOptions.hostname)}${\n            app.siteData.base\n          }${removeLeadingSlash(page.path)}`\n          const destLocation = path.join(\n            outputFolder,\n            removeLeadingSlash(page.path.replace(/\\/$/, '/index.html')),\n          )\n\n          return fs\n            .ensureDir(path.dirname(destLocation))\n            .then(() =>\n              fs.writeFile(destLocation, getRedirectHTML(redirectUrl)),\n            )\n        }),\n      )\n    },\n  )\n\nprogram.version(pkg.version)\nprogram.showHelpAfterError('add --help for additional information')\n\nawait program.parseAsync()\n"],"names":["version","package_default","getRedirectHTML","redirectUrl","program","createCommand","sourceDir","output","commandOptions","fs","cliAppConfig","resolveCliAppConfig","userConfigPath","resolveUserConfigPath","resolveUserConfigConventionalPath","userConfig","loadUserConfig","appConfig","resolveAppConfig","app","createBuildApp","transformUserConfigToPlugin","logger","outputFolder","path","page","removeEndingSlash","removeLeadingSlash","destLocation","pkg"],"mappings":";gaACE,IACAA,EAAW,eAFbC,EAAA,CAEE,QAAAD,CAuDF,ECzDO,MAAME,EAAmBC,GAAgC;AAAA;AAAA;AAAA;AAAA;AAAA,+CAKjBA,CAAW;AAAA,gCAC1BA,CAAW;AAAA;AAAA;AAAA;AAAA,gCAIXA,CAAW;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,ECerCC,EAAUC,EAAc,aAAa,EAE3CD,EACG,QAAQ,wBAAwB,EAChC,YAAY,qDAAqD,EACjE,OACC,wBACA,2DACA,GACF,EACC,OAAO,wBAAyB,yBAAyB,EACzD,OAAO,kBAAmB,sCAAsC,EAChE,OAAO,gBAAiB,0CAA0C,EAClE,OAAO,gBAAiB,yCAAyC,EACjE,OAAO,eAAgB,6CAA6C,EACpE,SAAS,WAAY,sCAAsC,EAC3D,SACC,WACA,uEACF,EACC,OACC,MACEE,EACAC,EACAC,IACG,CAEH,QAAQ,IAAI,WAAa,aAEpBC,EAAG,WAAWH,CAAS,GAC1BF,EAAQ,MAAM,oBAAoBE,CAAS,kBAAkB,EAI/D,MAAMI,EAAeC,EAAoBL,EAAW,CAAA,CAAE,EAGhDM,EAAiBJ,EAAe,OAClCK,EAAsBL,EAAe,MAAM,EAC3CM,EAAkCJ,EAAa,MAAM,EAEnD,CAAE,WAAAK,CAAW,EAAI,MAAMC,EAAeJ,CAAc,EAGpDK,EAAYC,EAAiB,CACjC,iBAAkB,CAChB,MAAOV,EAAe,MACtB,KAAMA,EAAe,IACvB,EACA,aAAAE,EACA,WAAAK,CACF,CAAC,EAED,GAAIE,IAAc,KAAM,OAGxB,MAAME,EAAMC,EAAeH,CAAS,EAGpCE,EAAI,IAAIE,EAA4BN,EAAYL,EAAa,MAAM,CAAC,EAGhEF,EAAe,YAAc,KAC/Bc,EAAO,KAAK,kBAAkB,EAC9B,MAAMb,EAAG,OAAOU,EAAI,IAAI,MAAM,GAE5BX,EAAe,aAAe,KAChCc,EAAO,KAAK,mBAAmB,EAC/B,MAAMb,EAAG,OAAOU,EAAI,IAAI,MAAA,CAAO,GAGjC,MAAMI,EAAehB,EACjBiB,EAAK,KAAK,QAAQ,MAAOjB,CAAM,EAC/BiB,EAAK,KAAKL,EAAI,IAAI,SAAU,YAAa,UAAU,EAGvD,MAAMV,EAAG,SAASc,CAAY,EAE9BD,EAAO,KAAK,6CAA6C,EAGzD,MAAMH,EAAI,KAAA,EAEVG,EAAO,KAAK,8BAA8B,EAG1C,MAAM,QAAQ,IACZH,EAAI,MAAM,IAAKM,GAAS,CACtB,MAAMtB,EAAc,GAAGuB,EAAkBlB,EAAe,QAAQ,CAAC,GAC/DW,EAAI,SAAS,IACf,GAAGQ,EAAmBF,EAAK,IAAI,CAAC,GAC1BG,EAAeJ,EAAK,KACxBD,EACAI,EAAmBF,EAAK,KAAK,QAAQ,MAAO,aAAa,CAAC,CAC5D,EAEA,OAAOhB,EACJ,UAAUe,EAAK,QAAQI,CAAY,CAAC,EACpC,KAAK,IACJnB,EAAG,UAAUmB,EAAc1B,EAAgBC,CAAW,CAAC,CACzD,CACJ,CAAC,CACH,CACF,CACF,EAEFC,EAAQ,QAAQyB,EAAI,OAAO,EAC3BzB,EAAQ,mBAAmB,uCAAuC,EAElE,MAAMA,EAAQ,WAAA"}