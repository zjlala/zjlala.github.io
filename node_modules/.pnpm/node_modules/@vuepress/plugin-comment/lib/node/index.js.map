{"version":3,"file":"index.js","sources":["../../src/node/utils.ts","../../src/node/getProvider.ts","../../src/node/locales.ts","../../src/node/commentPlugin.ts"],"sourcesContent":["import { Logger, ensureEndingSlash } from '@vuepress/helper'\nimport { getDirname, path } from 'vuepress/utils'\n\nconst __dirname = import.meta.dirname || getDirname(import.meta.url)\n\nexport const CLIENT_FOLDER = ensureEndingSlash(\n  path.resolve(__dirname, '../client'),\n)\n\nexport const PLUGIN_NAME = '@vuepress/plugin-comment'\n\nexport const logger = new Logger(PLUGIN_NAME)\n","import { getModulePath } from '@vuepress/helper'\nimport type { CommentPluginOptions } from './options.js'\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from './utils.js'\n\nconst COMMENT_SERVICES = ['Artalk', 'Giscus', 'Waline', 'Twikoo']\nconst PAGEVIEW_SERVICES = ['Artalk', 'Waline']\n\nexport const getServiceComponent = (provider = 'None'): string => {\n  if (COMMENT_SERVICES.includes(provider))\n    return `${CLIENT_FOLDER}components/${provider}Comment.js`\n\n  if (provider !== 'None') logger.error(`Invalid provider: ${provider}`)\n\n  return getModulePath('@vuepress/helper/noopModule', import.meta)\n}\n\nexport const getPageviewChunk = (provider = 'None'): string =>\n  `${CLIENT_FOLDER}pageview/${PAGEVIEW_SERVICES.includes(provider) ? provider.toLowerCase() : 'noop'}.js`\n\nexport const getAlias = (\n  options: CommentPluginOptions,\n): Record<string, string> => ({\n  [`${PLUGIN_NAME}/service`]: getServiceComponent(options.provider),\n  [`${PLUGIN_NAME}/pageview`]: getPageviewChunk(options.provider),\n})\n\nexport const getProviderPackage = (provider?: string): string | null => {\n  // eslint-disable-next-line @typescript-eslint/switch-exhaustiveness-check\n  switch (provider) {\n    case 'Artalk':\n      return 'artalk'\n    case 'Twikoo':\n      return 'twikoo'\n    case 'Waline':\n      return '@waline/client'\n\n    default:\n      return null\n  }\n}\n","import type { DefaultLocaleInfo } from '@vuepress/helper'\nimport type { WalineLocaleData } from '../shared/index.js'\n\n/**\n * Default locale info for Waline\n */\nexport const walineLocalesInfo: DefaultLocaleInfo<WalineLocaleData> = [\n  [\n    ['en', 'en-US'],\n    {\n      placeholder:\n        'Write a comment here (Fill in the email address to receive an email notification when being replied)',\n    },\n  ],\n  [\n    ['zh', 'zh-CN', 'zh-Hans'],\n    { placeholder: '请留言。(填写邮箱可在被回复时收到邮件提醒)' },\n  ],\n  [\n    ['zh-TW', 'zh-Hant'],\n    { placeholder: '請留言。(填寫信箱可在被回覆時收到郵件提醒)' },\n  ],\n  [\n    ['de', 'de-DE'],\n    {\n      placeholder:\n        'Schreibe ein Kommentar (Geben Sie die E-Mail-Adresse ein, um eine E-Mail-Benachrichtigung zu erhalten, wenn Sie eine Antwort erhalten)',\n    },\n  ],\n  [\n    ['vi', 'vi-VN'],\n    {\n      placeholder:\n        'Để lại bình luận (Điền địa chỉ email để nhận email thông báo khi được trả lời)',\n    },\n  ],\n  [\n    ['uk', 'uk-UA'],\n    {\n      placeholder:\n        'Напишіть тут коментар (введіть адресу електронної пошти, щоб отримувати сповіщення електронною поштою, коли буде відповідь)',\n    },\n  ],\n  [\n    ['ru', 'ru-RU'],\n    {\n      placeholder:\n        'Напишите комментарий здесь (Введите адрес электронной почты, чтобы получить уведомление по электронной почте при ответе)',\n    },\n  ],\n  [\n    ['br', 'br-BR'],\n    {\n      placeholder:\n        'Escreva um comentário aqui (preencha com o endereço de email para receber notificações quando tiver alguma resposta)',\n    },\n  ],\n  [\n    ['pl', 'pl-PL'],\n    {\n      placeholder:\n        'Wpisz tutaj komentarz (wpisz adres e-mail, aby otrzymać powiadomienie e-mail, gdy otrzymasz odpowiedź)',\n    },\n  ],\n  [\n    ['sk', 'sk-SK'],\n    {\n      placeholder:\n        'Napíš svoj komentár (vlož svoj e-mail taktiež, aby si bol notifikovaný o odpovediach)',\n    },\n  ],\n  [\n    ['fr', 'fr-FR'],\n    {\n      placeholder:\n        'Écrivez votre commentaire ici (Inscrivez votre email afin de recevoir une notification en cas de réponse)',\n    },\n  ],\n  [\n    ['es', 'es-ES'],\n    {\n      placeholder:\n        'Escriba un comentario aquí (Ingrese su correo electrónico para recibir una notificación en caso de respuesta)',\n    },\n  ],\n  [\n    ['ja', 'ja-JP'],\n    {\n      placeholder:\n        '伝言をどうぞ (メールアドレスを入力すると、返信があった際にメールでお知らせします。)',\n    },\n  ],\n  [\n    ['tr', 'tr-TR'],\n    {\n      placeholder:\n        'Buraya bir yorum yazın (Yanıtlandığında bir e-posta bildirimi almak için e-posta adresinizi girin)',\n    },\n  ],\n  [\n    ['ko', 'ko-KO'],\n    {\n      placeholder:\n        '댓글을 남겨주세요 (답글이 달렸을 때 이메일로 알림을 받으려면 이메일 주소를 입력하세요)',\n    },\n  ],\n  [\n    ['fi', 'fi-FI'],\n    {\n      placeholder:\n        'Kirjoita kommentti tähän (täytä sähköpostiosoite saadaksesi sähköposti-ilmoituksen vastauksesta)',\n    },\n  ],\n  [\n    ['hu', 'hu-HU'],\n    {\n      placeholder:\n        'Írj kommentet itt! (Töltsd ki az email címet, hogy értesítést kapj, amikor válaszolnak.)',\n    },\n  ],\n  [\n    ['id', 'id-ID'],\n    {\n      placeholder:\n        'Tulis komentar di sini (Isi alamat email untuk menerima notifikasi jika komentar kamu telah dibalas orang lain)',\n    },\n  ],\n  [\n    ['nl', 'nl-NL'],\n    {\n      placeholder:\n        'Schrijf een opmerking hier (Vul je emailadres in om een email-notificatie te ontvangen wanneer er gereageerd wordt.',\n    },\n  ],\n]\n","import {\n  addCustomElement,\n  addViteOptimizeDepsExclude,\n  addViteOptimizeDepsInclude,\n  addViteSsrExternal,\n  addViteSsrNoExternal,\n  getFullLocaleConfig,\n  isModuleAvailable,\n} from '@vuepress/helper'\nimport type { PluginFunction } from 'vuepress/core'\nimport { getAlias, getProviderPackage } from './getProvider.js'\nimport { walineLocalesInfo } from './locales.js'\nimport type { CommentPluginOptions } from './options.js'\nimport { CLIENT_FOLDER, PLUGIN_NAME, logger } from './utils.js'\n\n/**\n * VuePress comment plugin\n *\n * VuePress 评论插件\n *\n * @param options - Plugin options\n * 插件选项\n *\n * @returns VuePress plugin\n * VuePress 插件\n *\n * @example\n * ```ts\n * import { commentPlugin } from '@vuepress/plugin-comment'\n *\n * export default {\n *   plugins: [\n *     commentPlugin({\n *       provider: 'Waline',\n *       serverURL: 'https://waline.example.com',\n *     }),\n *   ],\n * }\n * ```\n */\nexport const commentPlugin =\n  (options: CommentPluginOptions): PluginFunction =>\n  (app) => {\n    if (app.env.isDebug) logger.info('Options:', options)\n\n    const pkg = getProviderPackage(options.provider)\n\n    if (pkg && !isModuleAvailable(pkg, import.meta)) {\n      logger.error(\n        `Package ${pkg} is not installed, please install it manually!`,\n      )\n\n      return { name: PLUGIN_NAME }\n    }\n\n    // Remove locales so that they won’t be injected in client twice\n    if (options.provider === 'Waline' && 'locales' in options)\n      delete options.locales\n\n    return {\n      name: PLUGIN_NAME,\n\n      alias: getAlias(options),\n\n      define: () => {\n        const userWalineLocales =\n          options.provider === 'Waline'\n            ? getFullLocaleConfig({\n                app,\n                name: 'waline',\n                default: walineLocalesInfo,\n                config: options.locales,\n              })\n            : {}\n\n        return {\n          __COMMENT_OPTIONS__: options,\n          ...(options.provider === 'Waline'\n            ? {\n                WALINE_LOCALES: userWalineLocales,\n                WALINE_META: options.metaIcon ?? true,\n              }\n            : {}),\n        }\n      },\n\n      extendsBundlerOptions: (bundlerOptions: unknown): void => {\n        // eslint-disable-next-line @typescript-eslint/switch-exhaustiveness-check, default-case\n        switch (options.provider) {\n          case 'Artalk': {\n            addViteOptimizeDepsExclude(\n              bundlerOptions,\n              app,\n              'artalk/dist/Artalk.mjs',\n            )\n            addViteSsrExternal(bundlerOptions, app, 'artalk')\n            break\n          }\n\n          case 'Giscus': {\n            addCustomElement(bundlerOptions, app, 'GiscusWidget')\n            addViteSsrExternal(bundlerOptions, app, 'giscus')\n            break\n          }\n\n          case 'Twikoo': {\n            addViteOptimizeDepsInclude(bundlerOptions, app, 'twikoo')\n            addViteSsrExternal(bundlerOptions, app, 'twikoo')\n            break\n          }\n\n          case 'Waline': {\n            addViteOptimizeDepsInclude(bundlerOptions, app, [\n              '@waline/client > autosize',\n              '@waline/client > recaptcha-v3',\n            ])\n            addViteOptimizeDepsExclude(bundlerOptions, app, '@waline/client')\n            addViteSsrExternal(bundlerOptions, app, '@waline/client')\n            break\n          }\n        }\n\n        addViteSsrNoExternal(bundlerOptions, app, [\n          '@vuepress/helper',\n          '@vuepress/plugin-comment',\n        ])\n      },\n\n      clientConfigFile: `${CLIENT_FOLDER}config.js`,\n    }\n  }\n"],"names":["__dirname","getDirname","CLIENT_FOLDER","ensureEndingSlash","path","PLUGIN_NAME","logger","Logger","COMMENT_SERVICES","PAGEVIEW_SERVICES","getServiceComponent","provider","getModulePath","getPageviewChunk","getAlias","options","getProviderPackage","walineLocalesInfo","commentPlugin","app","pkg","isModuleAvailable","userWalineLocales","getFullLocaleConfig","bundlerOptions","addViteOptimizeDepsExclude","addViteSsrExternal","addCustomElement","addViteOptimizeDepsInclude","addViteSsrNoExternal"],"mappings":"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"}