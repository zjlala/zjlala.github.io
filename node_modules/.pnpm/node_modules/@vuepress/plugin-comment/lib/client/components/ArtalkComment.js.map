{"version":3,"file":"ArtalkComment.js","sources":["../../../src/client/components/ArtalkComment.ts"],"sourcesContent":["import { LoadingIcon, isString, wait } from '@vuepress/helper/client'\nimport { watchImmediate } from '@vueuse/core'\nimport type Artalk from 'artalk'\nimport type { VNode } from 'vue'\nimport {\n  computed,\n  defineComponent,\n  h,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  shallowRef,\n  watch,\n} from 'vue'\nimport { useData } from 'vuepress/client'\nimport { useArtalkOptions } from '../helpers/index.js'\n\nimport 'artalk/dist/Artalk.css'\n\nexport default defineComponent({\n  name: 'ArtalkComment',\n\n  props: {\n    /**\n     * The identifier of the comment\n     *\n     * 评论标识符\n     */\n    identifier: {\n      type: String,\n      required: true,\n    },\n\n    /**\n     * Whether the component is in darkmode\n     *\n     * 组件是否处于夜间模式\n     */\n    darkmode: Boolean,\n  },\n\n  setup(props) {\n    const { page, site } = useData()\n    const artalkOptions = useArtalkOptions()\n\n    const loaded = ref(false)\n    const artalkContainer = shallowRef<HTMLDivElement>()\n\n    let artalk: Artalk | null = null\n\n    const enableArtalk = computed(() => isString(artalkOptions.value.server))\n\n    const initArtalk = async (): Promise<void> => {\n      if (__VUEPRESS_SSR__) return\n\n      const [{ default: Artalk }] = await Promise.all([\n        import(/* webpackChunkName: \"artalk\" */ 'artalk/dist/Artalk.mjs'),\n        wait(artalkOptions.value.delay ?? 800),\n      ])\n\n      loaded.value = true\n      await nextTick()\n\n      artalk = Artalk.init({\n        useBackendConf: false,\n        site: site.value.title,\n        pageTitle: page.value.title,\n        ...artalkOptions.value,\n        el: artalkContainer.value!,\n        pageKey: props.identifier,\n        darkMode: props.darkmode,\n      })\n\n      if (artalkOptions.value.useBackendConf)\n        artalk.on('mounted', () => {\n          artalk!.setDarkMode(props.darkmode)\n        })\n    }\n\n    onMounted(() => {\n      watchImmediate(\n        () => artalkOptions.value,\n        () => {\n          artalk?.destroy()\n          void initArtalk()\n        },\n        { flush: 'post' },\n      )\n\n      watch(\n        () => props.identifier,\n        () => {\n          artalk?.update({\n            site: site.value.title,\n            pageTitle: page.value.title,\n            pageKey: props.identifier,\n          })\n          artalk?.reload()\n        },\n        { flush: 'post' },\n      )\n\n      watch(\n        () => props.darkmode,\n        (value) => {\n          artalk?.setDarkMode(value)\n        },\n        { flush: 'post' },\n      )\n    })\n\n    onUnmounted(() => {\n      artalk?.destroy()\n    })\n\n    return (): VNode | null =>\n      enableArtalk.value\n        ? h('div', { class: 'artalk-wrapper' }, [\n            loaded.value ? null : h(LoadingIcon),\n            h('div', { ref: artalkContainer }),\n          ])\n        : null\n  },\n})\n"],"names":["ArtalkComment","defineComponent","props","page","site","useData","artalkOptions","useArtalkOptions","loaded","ref","artalkContainer","shallowRef","artalk","enableArtalk","computed","isString","initArtalk","Artalk","wait","nextTick","onMounted","watchImmediate","watch","value","onUnmounted","h","LoadingIcon"],"mappings":"2XAoBA,IAAAA,EAAeC,EAAgB,CAC7B,KAAM,gBAEN,MAAO,CAML,WAAY,CACV,KAAM,OACN,SAAU,EACZ,EAOA,SAAU,OACZ,EAEA,MAAMC,EAAO,CACX,KAAM,CAAE,KAAAC,EAAM,KAAAC,CAAK,EAAIC,EAAAA,EACjBC,EAAgBC,EAAAA,EAEhBC,EAASC,EAAI,EAAK,EAClBC,EAAkBC,EAAAA,EAExB,IAAIC,EAAwB,KAE5B,MAAMC,EAAeC,EAAS,IAAMC,EAAST,EAAc,MAAM,MAAM,CAAC,EAElEU,EAAa,SAA2B,CAC5C,GAAI,iBAAkB,OAEtB,KAAM,CAAC,CAAE,QAASC,CAAO,CAAC,EAAI,MAAM,QAAQ,IAAI,CAC9C,OAAwC,wBAAwB,EAChEC,EAAKZ,EAAc,MAAM,OAAS,GAAG,CACvC,CAAC,EAEDE,EAAO,MAAQ,GACf,MAAMW,EAAAA,EAENP,EAASK,EAAO,KAAK,CACnB,eAAgB,GAChB,KAAMb,EAAK,MAAM,MACjB,UAAWD,EAAK,MAAM,MACtB,GAAGG,EAAc,MACjB,GAAII,EAAgB,MACpB,QAASR,EAAM,WACf,SAAUA,EAAM,QAClB,CAAC,EAEGI,EAAc,MAAM,gBACtBM,EAAO,GAAG,UAAW,IAAM,CACzBA,EAAQ,YAAYV,EAAM,QAAQ,CACpC,CAAC,CACL,EAEA,OAAAkB,EAAU,IAAM,CACdC,EACE,IAAMf,EAAc,MACpB,IAAM,CACJM,GAAQ,QAAA,EACHI,EAAAA,CACP,EACA,CAAE,MAAO,MAAO,CAClB,EAEAM,EACE,IAAMpB,EAAM,WACZ,IAAM,CACJU,GAAQ,OAAO,CACb,KAAMR,EAAK,MAAM,MACjB,UAAWD,EAAK,MAAM,MACtB,QAASD,EAAM,UACjB,CAAC,EACDU,GAAQ,QACV,EACA,CAAE,MAAO,MAAO,CAClB,EAEAU,EACE,IAAMpB,EAAM,SACXqB,GAAU,CACTX,GAAQ,YAAYW,CAAK,CAC3B,EACA,CAAE,MAAO,MAAO,CAClB,CACF,CAAC,EAEDC,EAAY,IAAM,CAChBZ,GAAQ,QAAA,CACV,CAAC,EAEM,IACLC,EAAa,MACTY,EAAE,MAAO,CAAE,MAAO,gBAAiB,EAAG,CACpCjB,EAAO,MAAQ,KAAOiB,EAAEC,CAAW,EACnCD,EAAE,MAAO,CAAE,IAAKf,CAAgB,CAAC,CACnC,CAAC,EACD,IACR,CACF,CAAC"}