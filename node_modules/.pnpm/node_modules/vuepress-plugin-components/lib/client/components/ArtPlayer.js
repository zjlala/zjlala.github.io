import{LoadingIcon as h,keys as g}from"@vuepress/helper/client";import{defineComponent as T,ref as A,h as m,onMounted as P,onUnmounted as D,camelize as L}from"vue";import{useLang as w}from"vuepress/client";import{g as I}from"../getLink-DBmDl_2w.js";import"../styles/art-player.scss";import{u as v}from"../useSize-C8GaR9if.js";import"@vueuse/core";const y=["mp4","mp3","webm","ogg"];typeof DASHJS_INSTALLED<"u"&&DASHJS_INSTALLED&&y.push("mpd","dash"),typeof HLS_JS_INSTALLED<"u"&&HLS_JS_INSTALLED&&y.push("m3u8","hls"),typeof MPEGTS_JS_INSTALLED<"u"&&MPEGTS_JS_INSTALLED&&y.push("ts","flv");const N=e=>e.split(".").pop()??"",M=async(e,o,r,s=!1,a=0)=>{if(!__VUEPRESS_SSR__&&typeof DASHJS_INSTALLED<"u"&&DASHJS_INSTALLED){const S=(await import("dashjs")).default;if(S.supportsMediaSource()){const f=S.MediaPlayer().create();f.initialize(e,o,s,a),r(()=>{f.destroy()})}}},R=async(e,o,r)=>{if(!__VUEPRESS_SSR__&&typeof MPEGTS_JS_INSTALLED<"u"&&MPEGTS_JS_INSTALLED){const s=(await import("mpegts.js/dist/mpegts.js")).default;if(s.isSupported()){const a=s.createPlayer({type:"flv",url:o});a.attachMediaElement(e),a.load(),r(()=>{a.destroy()})}}},b=async(e,o,r)=>{if(!__VUEPRESS_SSR__){if(e.canPlayType("application/x-mpegURL")||e.canPlayType("application/vnd.apple.mpegURL"))e.src=o;else if(typeof HLS_JS_INSTALLED<"u"&&HLS_JS_INSTALLED){const s=(await import("hls.js/dist/hls.min.js")).default;if(s.isSupported()){const a=new s;a.attachMedia(e),a.on(s.Events.MEDIA_ATTACHED,()=>{a.loadSource(o)}),r(()=>{a.destroy()})}}}},J=["no-fullscreen","no-hotkey","no-playback-rate","no-setting","no-mutex","no-plays-inline"],k=["airplay","autoplay","aspect-ratio","auto-mini","auto-size","auto-orientation","auto-playback","fast-forward","flip","fullscreen-web","lock","loop","is-live","muted","mini-progress-bar","pip","screenshot","subtitle-offset"],z=["en","pl","cs","es","fa","fr","id","ru","tr"],H=["zh-cn","zh-tw"],U=e=>{const o=e.toLowerCase(),[r]=o.split("-");return H.includes(o)?o:z.includes(r)?r:r==="zh"?"zh-cn":"en"};var C=T({name:"ArtPlayer",inheritAttrs:!1,props:{src:{type:String,required:!0},type:String,poster:String,title:String,width:{type:[String,Number],default:"100%"},height:[String,Number],ratio:{type:[String,Number],default:16/9},config:Object,customPlayer:Function},setup(e,{attrs:o}){const r=w(),{el:s,width:a,height:S,resize:f}=v(e,0),d=A(!1);let _=null;const E=()=>{const t={theme:"#3eaf7c",...ART_PLAYER_OPTIONS,container:s.value,poster:e.poster,url:I(e.src),type:e.type??N(e.src),lang:U(r.value),...e.config,useSSR:!1},i=g(o);if(J.forEach(n=>{i.includes(n)&&(t[L(n.replace(/^no-/,""))]=!1)}),k.forEach(n=>{i.includes(n)&&(t[L(n)]=!0)}),t.type){const n=t.customType??={};if(y.includes(t.type.toLowerCase()))switch(t.type.toLowerCase()){case"m3u8":case"hls":n[t.type]??=(p,l,c)=>b(p,l,u=>{c.on("destroy",u)});break;case"flv":case"ts":n[t.type]??=(p,l,c)=>R(p,l,u=>{c.on("destroy",u)});break;case"mpd":case"dash":n[t.type]??=(p,l,c)=>M(p,l,u=>{c.on("destroy",u)});break}else console.warn(`[components]: ArtPlayer does not support current file type ${t.type}!`)}return t};return P(async()=>{if(__VUEPRESS_SSR__)return;const{default:t}=await import("artplayer"),i=new t(E());_=await e.customPlayer?.(i)??i,d.value=!0,f()}),D(()=>{_?.destroy()}),()=>[m("div",{ref:s,class:"vp-artplayer",style:{width:a.value,height:S.value}}),d.value?null:m(h)]}});export{C as default};
//# sourceMappingURL=ArtPlayer.js.map
