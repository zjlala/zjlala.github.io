import{isLinkHttp as A,isLinkAbsolute as q,startsWith as F,endsWith as L,isArray as C,isString as v,isPlainObject as H,isFunction as j}from"@vuepress/helper/client";import{defineComponent as h,ref as E,onMounted as M,h as o,computed as S}from"vue";import{useData as P,usePage as B}from"vuepress/client";import{Popup as R,openPopupWindow as W}from"vuepress-shared/client";import"balloon-css/balloon.css";import"vuepress-shared/client/styles/popup.scss";import"../styles/share-service.scss";const f=t=>document.querySelector(`meta[name="${t}"]`)?.getAttribute("content")??null,b=(t,l="")=>{const r=["vp-share-icon",l];return A(t)||q(t)?o("img",{class:r,src:t,loading:"lazy","no-view":""}):F(t,"<")&&L(t,">")?o("div",{class:r,innerHTML:t}):o("div",{class:[...r,t]})};var $=h({name:"ShareService",props:{config:{type:Object,required:!0},plain:Boolean,title:String,description:String,url:String,summary:String,cover:String,tag:[Array,String]},setup(t){let l;const{frontmatter:r,page:g}=P(),e=E(!1),a=()=>{const n=t.title??g.value.title,i=t.description??r.value.description??f("description")??f("og:description")??f("twitter:description"),c=t.url??typeof window>"u"?null:window.location.href,m=t.cover??f("og:image"),u=document.querySelector("[vp-content] :not(a) > img")?.getAttribute("src"),d=t.tag??r.value.tag??r.value.tags,y=C(d)?d.filter(v).join(","):v(d)?d:null;return t.config.link.replace(/\[([^\]]+)\]/g,(O,k)=>{const G=k.split("|");for(const s of G){if(s==="url"&&c)return c;if(s==="title"&&n)return n;if(s==="description"&&i)return i;if(s==="summary"&&t.summary)return t.summary;if(s==="cover"&&m)return m;if(s==="image"&&u)return u;if(s==="tags"&&y)return y}return""})},p=()=>{const n=a();switch(t.config.action){case"navigate":window.open(n);break;case"open":window.open(n,"_blank");break;case"qrcode":import("qrcode").then(({toDataURL:i})=>i(n,{errorCorrectionLevel:"H",width:250,scale:1,margin:1.5})).then(i=>{l.emit(`<img src="${i}" alt="qrcode" class="share-qrcode" />`)});break;default:W(n,"share")}};return M(()=>{l=new R}),()=>{const{config:{name:n,icon:i,shape:c,color:m},plain:u}=t;return[o("button",{type:"button",class:["vp-share-button",{plain:u}],"aria-label":n,"data-balloon-pos":"up",onClick:()=>{p()}},u?b(c,"plain"):i?b(i):o("div",{class:"vp-share-icon colorful",style:{background:m},innerHTML:c})),e.value?o("div",{class:"share-popup"}):null]}}});const w=SHARE_SERVICES;var D=h({name:"Share",props:{services:{type:[String,Array],default:()=>w.map(({name:t})=>t)},titleGetter:{type:Function,default:t=>t.title},descriptionGetter:{type:Function,default:t=>t.frontmatter.description},summaryGetter:{type:Function,default:t=>t.summary},coverGetter:{type:Function,default:t=>t.cover},tagGetter:{type:Function,default:({frontmatter:t})=>t.tag??t.tags},inline:Boolean,colorful:Boolean},setup(t){const l=B(),r=S(()=>(v(t.services)?t.services.split(","):t.services).map(e=>H(e)?e.name&&e.link?e:null:w.find(({name:a})=>a===e)).filter(e=>!!e)),g=S(()=>{const e={};return["titleGetter","descriptionGetter","summaryGetter","coverGetter","tagGetter"].forEach(a=>{if(j(t[a])){const p=t[a](l.value);p&&(e[a.replace("Getter","")]=p)}}),e});return()=>o("div",{class:"vp-share-buttons",style:t.inline?{display:"inline-block"}:{}},r.value.map(e=>o($,{config:e,...g.value,plain:!t.colorful})))}});export{D as default};
//# sourceMappingURL=Share.js.map
