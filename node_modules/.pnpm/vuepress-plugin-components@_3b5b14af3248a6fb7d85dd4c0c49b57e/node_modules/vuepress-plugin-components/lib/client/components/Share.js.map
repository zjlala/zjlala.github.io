{"version":3,"file":"Share.js","sources":["../../../src/client/utils/getMetaContent.ts","../../../src/client/components/ShareService.ts","../../../src/client/components/Share.ts"],"sourcesContent":["export const getMetaContent = (name: string): string | null =>\n  document\n    .querySelector<HTMLMetaElement>(`meta[name=\"${name}\"]`)\n    ?.getAttribute(\"content\") ?? null;\n","import {\n  endsWith,\n  isArray,\n  isLinkAbsolute,\n  isLinkHttp,\n  isString,\n  startsWith,\n} from \"@vuepress/helper/client\";\nimport type { PropType, VNode } from \"vue\";\nimport { defineComponent, h, onMounted, ref } from \"vue\";\nimport { useData } from \"vuepress/client\";\nimport { Popup, openPopupWindow } from \"vuepress-shared/client\";\n\nimport type { ShareServiceOptions } from \"../../shared/share.js\";\nimport { getMetaContent } from \"../utils/index.js\";\n\nimport \"balloon-css/balloon.css\";\nimport \"vuepress-shared/client/styles/popup.scss\";\nimport \"../styles/share-service.scss\";\n\nconst renderIcon = (content: string, contentClass = \"\"): VNode => {\n  const className = [\"vp-share-icon\", contentClass];\n\n  // is a link\n  if (isLinkHttp(content) || isLinkAbsolute(content))\n    return h(\"img\", {\n      class: className,\n      src: content,\n      loading: \"lazy\",\n      \"no-view\": \"\",\n    });\n\n  // is html content\n  if (startsWith(content, \"<\") && endsWith(content, \">\"))\n    return h(\"div\", { class: className, innerHTML: content });\n\n  // is class\n  return h(\"div\", { class: [...className, content] });\n};\n\nexport default defineComponent({\n  name: \"ShareService\",\n\n  props: {\n    /**\n     * Share config\n     *\n     * 分享配置\n     */\n    config: {\n      type: Object as PropType<ShareServiceOptions>,\n      required: true,\n    },\n\n    /**\n     * Whether use plain icon\n     */\n    plain: Boolean,\n\n    /**\n     * Share title\n     */\n    title: String,\n\n    /**\n     * Share description\n     */\n    description: String,\n\n    /**\n     * Share url\n     */\n    url: String,\n\n    /**\n     * Share summary\n     */\n    summary: String,\n\n    /**\n     * Share image\n     */\n    cover: String,\n\n    /**\n     * Share tag\n     */\n    tag: [Array, String] as PropType<string | string[]>,\n  },\n\n  setup(props) {\n    let popup: Popup;\n    const { frontmatter, page } = useData();\n\n    const showPopup = ref(false);\n\n    const getShareLink = (): string => {\n      const title = props.title ?? page.value.title;\n      const description =\n        props.description ??\n        frontmatter.value.description ??\n        getMetaContent(\"description\") ??\n        getMetaContent(\"og:description\") ??\n        getMetaContent(\"twitter:description\");\n      const url =\n        (props.url ?? typeof window === \"undefined\")\n          ? null\n          : window.location.href;\n      const cover = props.cover ?? getMetaContent(\"og:image\");\n      const image = document\n        .querySelector<HTMLImageElement>(\"[vp-content] :not(a) > img\")\n        ?.getAttribute(\"src\");\n      const tags = props.tag ?? frontmatter.value.tag ?? frontmatter.value.tags;\n      const tag = isArray(tags)\n        ? tags.filter(isString).join(\",\")\n        : isString(tags)\n          ? tags\n          : null;\n\n      return props.config.link.replace(\n        /\\[([^\\]]+)\\]/g,\n        (_, config: string): string => {\n          const keys = config.split(\"|\");\n\n          for (const key of keys) {\n            if (key === \"url\" && url) return url;\n            if (key === \"title\" && title) return title;\n            if (key === \"description\" && description) return description;\n            if (key === \"summary\" && props.summary) return props.summary;\n            if (key === \"cover\" && cover) return cover;\n            if (key === \"image\" && image) return image;\n            if (key === \"tags\" && tag) return tag;\n          }\n\n          return \"\";\n        },\n      );\n    };\n\n    const share = (): void => {\n      const link = getShareLink();\n\n      switch (props.config.action) {\n        case \"navigate\":\n          window.open(link);\n          break;\n\n        case \"open\":\n          window.open(link, \"_blank\");\n          break;\n\n        case \"qrcode\":\n          void import(/* webpackChunkName: \"qrcode\" */ \"qrcode\")\n            .then(({ toDataURL }) =>\n              toDataURL(link, {\n                errorCorrectionLevel: \"H\",\n                width: 250,\n                scale: 1,\n                margin: 1.5,\n              }),\n            )\n            .then((dataURL) => {\n              popup.emit(\n                `<img src=\"${dataURL}\" alt=\"qrcode\" class=\"share-qrcode\" />`,\n              );\n            });\n          break;\n\n        // \"popup\" shall be default action\n        default:\n          openPopupWindow(link, \"share\");\n      }\n    };\n\n    onMounted(() => {\n      popup = new Popup();\n    });\n\n    return (): (VNode | null)[] => {\n      const {\n        config: { name, icon, shape, color },\n        plain,\n      } = props;\n\n      return [\n        h(\n          \"button\",\n          {\n            type: \"button\",\n            class: [\"vp-share-button\", { plain }],\n            \"aria-label\": name,\n            \"data-balloon-pos\": \"up\",\n            onClick: () => {\n              share();\n            },\n          },\n          plain\n            ? renderIcon(shape, \"plain\")\n            : icon\n              ? renderIcon(icon)\n              : h(\"div\", {\n                  class: \"vp-share-icon colorful\",\n                  style: {\n                    background: color,\n                  },\n                  innerHTML: shape,\n                }),\n        ),\n        showPopup.value ? h(\"div\", { class: \"share-popup\" }) : null,\n      ];\n    };\n  },\n});\n","import { isFunction, isPlainObject, isString } from \"@vuepress/helper/client\";\nimport type { PropType, VNode } from \"vue\";\nimport { computed, defineComponent, h } from \"vue\";\nimport type { PageData } from \"vuepress/client\";\nimport { usePage } from \"vuepress/client\";\n\nimport ShareService from \"./ShareService.js\";\nimport type { ShareServiceOptions } from \"../../shared/share.js\";\n\ndeclare const SHARE_SERVICES: ShareServiceOptions[];\n\nconst shareServices = SHARE_SERVICES;\n\nexport default defineComponent({\n  // eslint-disable-next-line vue/multi-word-component-names\n  name: \"Share\",\n\n  props: {\n    /**\n     * Share services\n     *\n     * PDF 文件链接，应为完整链接\n     */\n    services: {\n      type: [String, Array] as PropType<\n        string | (ShareServiceOptions | string)[]\n      >,\n\n      default: () => shareServices.map(({ name }) => name),\n    },\n\n    /**\n     * Getter for page title\n     */\n    titleGetter: {\n      type: Function as PropType<(page: PageData) => string>,\n      default: (page: PageData) => page.title,\n    },\n\n    /**\n     * Getter for page description\n     */\n    descriptionGetter: {\n      type: Function as PropType<(page: PageData) => string | undefined | null>,\n      default: (page: PageData) => page.frontmatter.description,\n    },\n\n    /**\n     * Getter for page summary\n     */\n    summaryGetter: {\n      type: Function as PropType<(page: PageData) => string | undefined | null>,\n      default: (page: PageData<{ summary?: string }>) => page.summary,\n    },\n\n    /**\n     * Getter for page summary\n     */\n    coverGetter: {\n      type: Function as PropType<(page: PageData) => string | undefined | null>,\n      default: (page: PageData<{ cover?: string }>) => page.cover,\n    },\n\n    /**\n     * Getter for page summary\n     */\n    tagGetter: {\n      type: Function as PropType<\n        (page: PageData) => string | string[] | undefined | null\n      >,\n\n      default: ({\n        frontmatter,\n      }: PageData<\n        Record<never, never>,\n        { tag?: string | string[]; tags?: string | string[] }\n      >) => frontmatter.tag ?? frontmatter.tags,\n    },\n\n    /**\n     * Whether to display the share component inline\n     */\n    inline: Boolean,\n\n    /**\n     * Use colorful icon\n     */\n    colorful: Boolean,\n  },\n\n  setup(props) {\n    const page = usePage();\n\n    const services = computed(() => {\n      const serviceOptions = isString(props.services)\n        ? props.services.split(\",\")\n        : props.services;\n\n      return serviceOptions\n        .map((item) =>\n          isPlainObject(item)\n            ? item.name && item.link\n              ? item\n              : null\n            : shareServices.find(({ name }) => name === item),\n        )\n        .filter((item): item is ShareServiceOptions => Boolean(item));\n    });\n\n    const shareData = computed(() => {\n      const result: Record<string, string | string[]> = {};\n\n      (\n        [\n          \"titleGetter\",\n          \"descriptionGetter\",\n          \"summaryGetter\",\n          \"coverGetter\",\n          \"tagGetter\",\n        ] as const\n      ).forEach((item) => {\n        if (isFunction(props[item])) {\n          const value = props[item](page.value);\n\n          if (value) result[item.replace(\"Getter\", \"\")] = value;\n        }\n      });\n\n      return result;\n    });\n\n    return (): VNode =>\n      h(\n        \"div\",\n        {\n          class: \"vp-share-buttons\",\n          style: props.inline ? { display: \"inline-block\" } : {},\n        },\n        services.value.map((item) =>\n          h(ShareService, {\n            config: item,\n            ...shareData.value,\n            plain: !props.colorful,\n          }),\n        ),\n      );\n  },\n});\n"],"names":["getMetaContent","name","renderIcon","content","contentClass","className","isLinkHttp","isLinkAbsolute","h","startsWith","endsWith","defineComponent","props","popup","frontmatter","page","useData","showPopup","ref","getShareLink","title","description","url","cover","image","tags","tag","isArray","isString","_","config","keys","key","share","link","toDataURL","dataURL","openPopupWindow","onMounted","Popup","icon","shape","color","plain","shareServices","Share","usePage","services","computed","item","isPlainObject","shareData","result","isFunction","value","ShareService"],"mappings":"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"}